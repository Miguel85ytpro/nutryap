<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora TMB/GCT/PCI - NutriApp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-success bg-gradient d-flex flex-column min-vh-100">

    <nav class="navbar navbar-expand-lg navbar-dark bg-success shadow-sm">
        <div class="container">
            <a class="navbar-brand mb-0 h1 fw-bold" href="index.html">NutriApp</a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="calculadoras_dashboard.html">Calculadoras</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container flex-grow-1 d-flex flex-column justify-content-start align-items-center py-5">
        <div class="row w-100">
            <div class="col-lg-7 col-md-10 mx-auto">
                <h1 class="text-center mb-4 text-white">Calculadora TMB, GCT y Peso Ideal</h1>
                
                <div class="bg-white p-5 rounded-4 shadow-lg text-dark">
                    <h3 class="text-success mb-4">Ingresa tus datos metabólicos</h3>
                    
                    <form id="tmbForm">
                        <div class="mb-3">
                            <label for="weight_tmb" class="form-label">Peso (kg):</label>
                            <input type="number" step="0.1" id="weight_tmb" class="form-control" required placeholder="Ej: 70.5" min="1" aria-label="Peso en kilogramos">
                        </div>
                        <div class="mb-3">
                            <label for="height_tmb" class="form-label">Altura (cm):</label>
                            <input type="number" id="height_tmb" class="form-control" required placeholder="Ej: 175" min="1" aria-label="Altura en centímetros">
                        </div>
                        <div class="mb-3">
                            <label for="age_tmb" class="form-label">Edad (años):</label>
                            <input type="number" id="age_tmb" class="form-control" required placeholder="Ej: 30" min="1" aria-label="Edad en años">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Género:</label>
                            <select id="gender_tmb" class="form-select" required aria-label="Género">
                                <option value="">Selecciona tu género</option>
                                <option value="male">Masculino</option>
                                <option value="female">Femenino</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="activity_level_tmb" class="form-label">Nivel de Actividad:</label>
                            <select id="activity_level_tmb" class="form-select" required aria-label="Nivel de Actividad">
                                <option value="sedentario">Sedentario (poco o ningún ejercicio)</option>
                                <option value="ligero">Ligero (ejercicio 1-3 días/semana)</option>
                                <option value="moderado">Moderado (ejercicio 3-5 días/semana)</option>
                                <option value="activo">Activo (ejercicio 6-7 días/semana)</option>
                                <option value="muy_activo">Muy Activo (ejercicio intenso diario)</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-success w-100 fw-bold py-2">Calcular TMB, GCT y Peso Ideal</button>
                    </form>

                    <div id="results" class="mt-5 p-4 rounded-4 shadow-lg d-none">
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-dark text-white-50 text-center py-3 mt-auto">
        <div class="container small">
            <p class="mb-0">NutriApp &copy; 2024</p>
        </div>
    </footer>

    <script>
        const FACTORES_ACTIVIDAD = {
            "sedentario": 1.2,
            "ligero": 1.375,
            "moderado": 1.55,
            "activo": 1.725,
            "muy_activo": 1.9
        };

        document.getElementById('tmbForm').addEventListener('submit', function(event) {
            event.preventDefault();
            calcularYMostrarTMBGCT();
        });

        function calcularTMB(peso, alturaCm, edad, genero) {
            if (genero === 'male') {
                return (10 * peso) + (6.25 * alturaCm) - (5 * edad) + 5;
            } else if (genero === 'female') {
                return (10 * peso) + (6.25 * alturaCm) - (5 * edad) - 161;
            }
            return null;
        }

        function calcularGCT(tmb, nivelActividad) {
            const factor = FACTORES_ACTIVIDAD[nivelActividad] || 1.2;
            return tmb * factor;
        }

        function calcularPesoIdeal(alturaCm, genero) {
            if (alturaCm < 152.4) {
                if (genero === 'male') return 50;
                if (genero === 'female') return 45.5;
                return null;
            }

            if (genero === 'male') {
                return 50 + 0.91 * (alturaCm - 152.4);
            } else if (genero === 'female') {
                return 45.5 + 0.91 * (alturaCm - 152.4);
            }
            return null;
        }

        function calcularYMostrarTMBGCT() {
            const peso = parseFloat(document.getElementById('weight_tmb').value);
            const alturaCm = parseFloat(document.getElementById('height_tmb').value);
            const edad = parseInt(document.getElementById('age_tmb').value);
            const genero = document.getElementById('gender_tmb').value;
            const nivelActividad = document.getElementById('activity_level_tmb').value;
            const resultsDiv = document.getElementById('results');

            if (isNaN(peso) || isNaN(alturaCm) || isNaN(edad) || peso <= 0 || alturaCm <= 0 || edad <= 0 || !genero) {
                displayError("Por favor, ingresa valores numéricos válidos y selecciona un género.");
                return;
            }

            const tmb = calcularTMB(peso, alturaCm, edad, genero);
            const gct = calcularGCT(tmb, nivelActividad);
            const pesoIdeal = calcularPesoIdeal(alturaCm, genero);

            if (tmb === null || gct === null || pesoIdeal === null) {
                displayError("Error interno en el cálculo. Verifica los datos.");
                return;
            }
            
            let resultHtml = `
                <h2 class="mb-3 text-center text-success">Tasa Metabólica, Gasto Calórico y Peso Ideal</h2>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Tasa Metabólica Basal (TMB):
                        <span class="badge bg-success rounded-pill">${tmb.toFixed(0)} Kcal/día</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Gasto Calórico Total (GCT):
                        <span class="badge bg-primary rounded-pill">${gct.toFixed(0)} Kcal/día</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Peso Corporal Ideal (PCI):
                        <span class="badge bg-info rounded-pill">${pesoIdeal.toFixed(1)} kg</span>
                    </li>
                </ul>
            `;

            resultsDiv.innerHTML = resultHtml;
            resultsDiv.classList.remove('d-none', 'bg-danger-subtle', 'text-danger');
            resultsDiv.classList.add('bg-light');

            sessionStorage.setItem('ultimoGCT', gct.toFixed(0));
        }

        function displayError(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <h2 class="mb-3 text-center text-danger">Error</h2>
                <div class="alert alert-danger" role="alert">${message}</div>
            `;
            resultsDiv.classList.remove('d-none', 'bg-light');
            resultsDiv.classList.add('bg-danger-subtle', 'text-danger');
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>